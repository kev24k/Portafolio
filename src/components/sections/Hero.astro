---
import { basics } from "@cv";
import Section from "@/components/Section.astro";
import Mail from "@/icons/Mail.astro";
import Phone from "@/icons/Phone.astro";
import LinkedIn from "@/icons/LinkedIn.astro";
import GitHub from "@/icons/GitHub.astro";
import WorldMap from "@/icons/WorldMap.astro";
import type { SocialIcon, Component } from "@/types";

/**
 * Componente Hero
 * 
 * Muestra la información principal del usuario: nombre, título, ubicación,
 * imagen de perfil y enlaces a redes sociales y contacto.
 * Es la primera sección visible del portafolio.
 */

const { name, label, image, location, profiles, phone, email } = basics;
const { city, region } = location;

// Mapeo de iconos de redes sociales disponibles
const SOCIAL_ICONS: Record<string, Component> = {
	GitHub,
	LinkedIn,
	
};

const linkedInfo = profiles.find(({ network }) => network === "LinkedIn");
const linkedUrl = linkedInfo?.url;

const printInfo = [email, phone, linkedUrl].filter(Boolean).join(" • ");
---

<Section>
	<div class="flex flex-col-reverse gap-8 md:flex-row md:items-center">
		
		<div class="info flex-1">
			<h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl mb-2">{name}</h1>
			<h2 class="text-lg text-skin-muted mb-4 text-balance">{label}</h2>
			<div class="flex items-center gap-2 text-sm text-skin-muted mb-6 print:hidden">
				<WorldMap />
				{city}, {region}
			</div>
			<footer class="print text-sm text-black font-medium mt-2">
				<div class="flex flex-col gap-1">
					{email && <span>{email}</span>}
					{phone && <span>{phone}</span>}
					{linkedUrl && <span>{linkedUrl.replace('https://', '')}</span>}
					<span class="text-xs text-skin-muted mt-1">{city}, {region}</span>
				</div>
			</footer>
			<footer class="no-print flex gap-2">
				{
					email && (
						<div x-data=`{ copyText: '${email}', copyNotification: false, copyToClipboard() { navigator.clipboard.writeText(this.copyText); this.copyNotification = true; let that = this; setTimeout(function(){ that.copyNotification = false; }, 3000); } }` class="relative">
							<div x-show="copyNotification" 
							x-transition:enter="transition ease-out duration-300" 
							x-transition:enter-start="opacity-0 translate-y-3" x-transition:enter-end="opacity-100 translate-x-0" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 translate-x-0" x-transition:leave-end="opacity-0 translate-y-2" style="display:none;" class="absolute left-0 -top-10" x-cloak>
								<div class="flex items-center rounded bg-green-500 px-2 py-1 text-xs text-white shadow-sm">
									<span>Copied!</span>
								</div>
							</div>
							<button @click="copyToClipboard();" class="group flex h-9 w-9 cursor-pointer items-center justify-center rounded-lg border border-skin-hue/20 bg-skin-button-accent/10 text-skin-muted transition-all hover:bg-skin-button-accent hover:text-skin-inverted" aria-label="Copiar email">
								<svg x-show="copyNotification" class="h-4 w-4 stroke-current text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak>
									<path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
								</svg>
								<span x-show="!copyNotification">
									<Mail />
								</span>
							</button>
						</div>
					)
				}
				{
					phone && (
						<a href={`tel:${phone}`} title={`Call ${name} at ${phone}`} target="_blank" rel="noopener noreferrer" class="group flex h-9 w-9 items-center justify-center rounded-lg border border-skin-hue/20 bg-skin-button-accent/10 text-skin-muted transition-all hover:bg-skin-button-accent hover:text-skin-inverted">
							<Phone />
						</a>
					)
				}
				{
					profiles.map(({ network, url }) => {
						const Icon = SOCIAL_ICONS[network];

						return (
							<a href={url} title={`Visit ${name} profile on ${network}`} target="_blank" rel="noopener noreferrer" class="group flex h-9 w-9 items-center justify-center rounded-lg border border-skin-hue/20 bg-skin-button-accent/10 text-skin-muted transition-all hover:bg-skin-button-accent hover:text-skin-inverted">
								<Icon />
							</a>
						);
					})
				}
			</footer>
		</div>
		<figure class="print:hidden relative shrink-0 mx-auto md:mx-0">
  <img 
    class="shadow-xl shadow-skin-hues w-32 h-32 md:w-40 md:h-40 rounded-2xl object-cover ring-1 ring-skin-hue/20" 
    src={image} 
    alt={name} 
  />

  <div class="pointer-events-none absolute -inset-1 md:-inset-2">
    <div class="absolute -inset-y-4 md:-inset-y-8 right-0 w-px bg-skin-hue/20 [mask-image:linear-gradient(to_top,transparent,white_2rem,white_calc(100%-2rem),transparent)] md:[mask-image:linear-gradient(to_top,transparent,white_4rem,white_calc(100%-4rem),transparent)]"></div>
    
    <div class="absolute -inset-y-4 md:-inset-y-8 left-0 w-px bg-skin-hue/20 [mask-image:linear-gradient(to_top,transparent,white_2rem,white_calc(100%-2rem),transparent)] md:[mask-image:linear-gradient(to_top,transparent,white_4rem,white_calc(100%-4rem),transparent)]"></div>
    
    <div class="absolute -inset-x-4 md:-inset-x-8 bottom-0 h-px bg-skin-hue/20 [mask-image:linear-gradient(to_left,transparent,white_2rem,white_calc(100%-2rem),transparent)] md:[mask-image:linear-gradient(to_left,transparent,white_4rem,white_calc(100%-4rem),transparent)]"></div>
    
    <div class="absolute -inset-x-4 md:-inset-x-8 top-0 h-px bg-skin-hue/20 [mask-image:linear-gradient(to_left,transparent,white_2rem,white_calc(100%-2rem),transparent)] md:[mask-image:linear-gradient(to_left,transparent,white_4rem,white_calc(100%-4rem),transparent)]"></div>
  </div>
</figure>
	</div>
</Section>

<style>
	.info {
		@apply flex flex-col gap-1 pr-8 print:gap-0 print:pr-0;
	}

	h1 {
		@apply text-4xl font-bold print:text-3xl;
	}

	h2 {
		@apply text-balance text-base text-skin-muted print:text-lg;
	}

	img {
		@apply aspect-square w-32 rounded-2xl bg-cover;
	}

	span {
		@apply flex items-center gap-1 text-xs text-skin-hue ;
	}

	footer {
		@apply mt-2 flex gap-1 text-sm ;
	}

	footer a, footer button {
		@apply inline-flex size-8 items-center justify-center rounded-md p-1 transition-all duration-500 ease-linear text-skin-hue hover:bg-skin-button-accent hover:text-skin-inverted;
	}

	@media (width <= 700px) {
		.container {
			flex-direction: column-reverse;
		}

		.info {
			@apply md:items-center md:justify-center pr-0 ;
		}

		figure {
			@apply flex md:items-center md:justify-center;
		}

		h2 {
			text-wrap: balance;
		}

		figure {
			@apply md:mx-auto;
		}
	}
</style>

<script>
	const select = document.getElementById("themeSwitch") as HTMLSelectElement;
	const theme = localStorage.getItem("theme");
	const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";

	if (theme !== null) {
		select.value = theme;
	} else {
		select.value = systemTheme;
	}

	function updateTheme(value: string) {
		const theme = value === "system" ? systemTheme : value;
		document.documentElement.classList.remove("light", "dark");
		document.documentElement.classList.add(theme);
		localStorage.setItem("theme", value);
	}

	updateTheme(select.value);

	select.addEventListener("change", (event: Event) => {
		const select = event.target as HTMLSelectElement;
		updateTheme(select.value);
	});

	// Deshabilitar modo oscuro al imprimir
	window.addEventListener("beforeprint", () => {
		document.documentElement.classList.remove("dark");
	});

	// Restaurar el modo oscuro después de imprimir
	window.addEventListener("afterprint", () => {
		if (select.value === "dark" || (select.value === "system" && systemTheme === "dark")) {
			document.documentElement.classList.add("dark");
		}
	});
</script>
